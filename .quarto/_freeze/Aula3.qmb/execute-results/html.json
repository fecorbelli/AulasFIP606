{
  "hash": "109b41ccf126596cd146f1f730de1087",
  "result": {
    "markdown": "---\ntitle: \"Aula3\"\nformat: html\neditor: visual\nmessage: false\nwarning: false\neditor_options: \n  chunk_output_type: inline\n---\n\n\n## Importando os dados\n\nQuando o conjunto de dados está em um arquivo csv na web, podemos utilizar a função `read_csv(\"endereço na web\")` para importar os dados para o programa.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary (tidyverse)\ncr <- read_csv (\"https://raw.githubusercontent.com/emdelponte/paper-coffee-rust-Ethiopia/master/data/survey_clean.csv\")\n\n\nglimpse(cr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 405\nColumns: 13\n$ farm            <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,…\n$ region          <chr> \"SNNPR\", \"SNNPR\", \"SNNPR\", \"SNNPR\", \"SNNPR\", \"SNNPR\", …\n$ zone            <chr> \"Bench Maji\", \"Bench Maji\", \"Bench Maji\", \"Bench Maji\"…\n$ district        <chr> \"Debub Bench\", \"Debub Bench\", \"Debub Bench\", \"Debub Be…\n$ lon             <dbl> 35.44250, 35.44250, 35.42861, 35.42861, 35.42861, 35.3…\n$ lat             <dbl> 6.904722, 6.904722, 6.904444, 6.904444, 6.904444, 6.90…\n$ altitude        <dbl> 1100, 1342, 1434, 1100, 1400, 1342, 1432, 1100, 1400, …\n$ cultivar        <chr> \"Local\", \"Mixture\", \"Mixture\", \"Local\", \"Local\", \"Mixt…\n$ shade           <chr> \"Sun\", \"Mid shade\", \"Mid shade\", \"Sun\", \"Sun\", \"Mid sh…\n$ cropping_system <chr> \"Plantation\", \"Plantation\", \"Plantation\", \"Plantation\"…\n$ farm_management <chr> \"Unmanaged\", \"Minimal\", \"Minimal\", \"Unmanaged\", \"Unman…\n$ inc             <dbl> 86.70805, 51.34354, 43.20000, 76.70805, 47.15808, 51.3…\n$ sev2            <dbl> 55.57986, 17.90349, 8.25120, 46.10154, 12.25167, 19.91…\n```\n:::\n:::\n\n\n# Visualização de Dados\n\nPodemos utilizar a biblioteca ggplot2 para vizualizar os dados do conjunto.\n\nA função `geom_histogram()` irá criar um gráfico do tipo histograma com os dados, esse gráfico é indicado para variáveis resposta do tipo númerica contínua. Já a função `geom_boxplot()` irá criar um gráfico do tipo boxplot com os dados, esse tipo de gráfico apresenta a localização de 50% dos dados, bem como a mediana, quartil inferior e superior.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr %>%  \n  ggplot (aes(x=inc))+ geom_histogram()\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncr %>%  \n  ggplot (aes(farm, inc))+ geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n:::\n\n\nA função facet_wrap é adicionada para separar os dados por região.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr %>%  \n  ggplot (aes(x=inc))+ geom_histogram()+ facet_wrap(~region)\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncr %>%  \n  ggplot (aes(x=inc))+ geom_boxplot()+ facet_wrap(~region)\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n:::\n\n\n# Sumarização\n\nPodemos utilizar a função `summary()` para obter os valores mínimos e máximos, média, mediana e quartil superior e inferior do conjunto simultaneamente. Podemos utilizar também a função `summarise()` para encontrar separadamente cada valor, sendo possível encontrar o valor de desvio padrão também. A função `group_by()` é utilizada para estabelecer como o conjunto de dados será agrupado.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(cr$inc)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   9.50   19.43   32.50   34.89   48.20   86.71 \n```\n:::\n\n```{.r .cell-code}\n#média do conjunto de dados\ncr %>% \n  group_by(region) %>% \n  summarise(inc_mean = mean(inc))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  region inc_mean\n  <chr>     <dbl>\n1 Oromia     37.0\n2 SNNPR      33.4\n```\n:::\n\n```{.r .cell-code}\n#média e desvio padrão\ncr %>% \n  group_by(region) %>% \n  summarise(inc_mean = mean(inc), sd_mean = sd(inc))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 3\n  region inc_mean sd_mean\n  <chr>     <dbl>   <dbl>\n1 Oromia     37.0    14.6\n2 SNNPR      33.4    18.9\n```\n:::\n\n```{.r .cell-code}\n#média, mediana e desvio padrão\ncr %>% \n  group_by(region) %>% \n  summarise(inc_mean = mean(inc),inc_med = median(inc), sd_mean = sd(inc))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 4\n  region inc_mean inc_med sd_mean\n  <chr>     <dbl>   <dbl>   <dbl>\n1 Oromia     37.0    39.5    14.6\n2 SNNPR      33.4    29.6    18.9\n```\n:::\n\n```{.r .cell-code}\ncr %>% \n  group_by(cultivar) %>% \n  summarise(inc_mean = mean(inc),inc_med = median(inc), sd_mean = sd(inc))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 4\n  cultivar inc_mean inc_med sd_mean\n  <chr>       <dbl>   <dbl>   <dbl>\n1 Improved     16.4    15.2    5.66\n2 Local        53.4    50.9   14.3 \n3 Mixture      31.9    31.6   11.2 \n```\n:::\n:::\n\n\n# Visualização\n\nPodemos utilizar a biblioteca ggplot2 para vizualizar os dados do conjunto em diferentes formas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr %>% \n  ggplot(aes(inc,sev2)) + geom_point()\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncr %>%  \n  ggplot (aes(x=sev2))+ geom_histogram()+ facet_wrap(~region)\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n```{.r .cell-code}\ncr %>% \n  group_by(cultivar) %>% \n  summarise(sev_mean = mean(sev2),sev_med = median(sev2), sev_sd = sd(sev2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 4\n  cultivar sev_mean sev_med sev_sd\n  <chr>       <dbl>   <dbl>  <dbl>\n1 Improved     2.16    1.64   1.82\n2 Local       18.7    17.2   11.1 \n3 Mixture      6.47    5.43   4.35\n```\n:::\n\n```{.r .cell-code}\ncr %>%  \n  ggplot (aes(x = sev2)) + geom_histogram()+ facet_wrap(region ~ cultivar)\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-5-3.png){width=672}\n:::\n\n```{.r .cell-code}\ncr %>%  \n  ggplot (aes(x = sev2)) + geom_histogram() + facet_grid(region ~ cultivar)\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-5-4.png){width=672}\n:::\n\n```{.r .cell-code}\ncr %>%  \n  ggplot (aes(x = sev2, fill = region)) + geom_histogram() + facet_wrap(region ~ cultivar)\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-5-5.png){width=672}\n:::\n:::\n\n\n## Personalização da Visualização dos dados\n\nO pacote **ggthemes** apresenta diversos temas que podem ser utilizados para personalizar os gráficos, bem como possibilidades de personalização dos elementos gráficos.\n\nPodemos utilizar `scale_fill_colorblind()` para uma coloração pré-definida para as colunas ou adicionar manualmente as cores desejadas com `scale_fill_manual()`. Podemos adicionar um tema como, por exemplo, `theme_minimal()` e adicionar anotações com a função `labs()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggthemes)\n\ncr %>%  \nggplot (aes(x = sev2, fill = region))+\ngeom_histogram()+\nfacet_grid(region ~ cultivar)+\nscale_fill_colorblind()\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncr %>% \nggplot (aes(x = sev2, fill = region))+\ngeom_histogram()+\nfacet_grid(region ~ cultivar)+ \nscale_fill_manual(values = c(\"red\",\"blue\"))+\ntheme_minimal(base_size = 14)+\ntheme(legend.position = \"bottom\")+\nlabs (y= \"frequency\", \n     x= \"severity (%)\", fill = \"region\")\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n\n```{.r .cell-code}\ncr %>% \nggplot (aes(x = sev2, fill = region))+\ngeom_histogram(color = \"white\") +\nfacet_grid(region ~ cultivar)+ \nscale_fill_manual(values = c(\"red\",\"blue\"))+\ntheme_minimal(base_size = 14)+\ntheme(legend.position = \"bottom\")+\nlabs (y= \"frequency\", \n     x= \"severity (%)\", fill = \"region\")\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-6-3.png){width=672}\n:::\n:::\n\n\n# Criar Subconjuntos\n\nPodemos utilizar as funções `select()` e `filter()` do pacote **dplyr** para selecionar colunas e linhas, respectivamente\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# filtra Oromia\n\ncr_oromia <- cr %>% \n  select (farm, region, cultivar, sev2) %>% \n  filter(region == \"Oromia\")\n\ncr_oromia\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 165 × 4\n    farm region cultivar  sev2\n   <dbl> <chr>  <chr>    <dbl>\n 1   286 Oromia Mixture   7.63\n 2   287 Oromia Mixture   9.39\n 3   288 Oromia Mixture   1.30\n 4   289 Oromia Mixture   9.79\n 5   290 Oromia Local    18.5 \n 6   291 Oromia Mixture  13.2 \n 7   292 Oromia Mixture   5.60\n 8   293 Oromia Mixture   1.06\n 9   294 Oromia Local    17.6 \n10   295 Oromia Mixture  15.4 \n# ℹ 155 more rows\n```\n:::\n\n```{.r .cell-code}\n# filtra SNNPR\ncr_pr <- cr %>% \n  select (farm, region, cultivar, sev2) %>% \n  filter(region == \"SNNPR\")\n\ncr_pr\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 240 × 4\n    farm region cultivar  sev2\n   <dbl> <chr>  <chr>    <dbl>\n 1     1 SNNPR  Local    55.6 \n 2     2 SNNPR  Mixture  17.9 \n 3     3 SNNPR  Mixture   8.25\n 4     4 SNNPR  Local    46.1 \n 5     5 SNNPR  Local    12.3 \n 6     6 SNNPR  Mixture  19.9 \n 7     7 SNNPR  Mixture  11.9 \n 8     8 SNNPR  Local    55.6 \n 9     9 SNNPR  Local    11.6 \n10    10 SNNPR  Mixture  11.4 \n# ℹ 230 more rows\n```\n:::\n:::\n\n\n## Visualização dos subconjuntos\n\nCriação de gráficos boxplot para cada subconjunto.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- cr_oromia %>% \n  ggplot(aes(cultivar,sev2, fill = cultivar))+ \n  geom_boxplot()+\n  theme_few()+\n  scale_fill_few()+\n  labs(x = \"\", \n       y= \"Severity (%)\") +\n  coord_flip()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np2 <- cr_pr %>% \n  ggplot(aes(cultivar,sev2, fill = cultivar))+ \n  geom_boxplot()+\n  theme_few()+\n  scale_fill_few()+\n  labs(x= \"\", \n       y= \"Severity(%)\") +\ncoord_flip()\n```\n:::\n\n\n## Juntar os gráficos em diferentes posicionamntos\n\nPara juntar diferentes gráficos em uma mesma imagem podemos utilizar o pacote **patchwork**. Para posicionamento ao lado utilizamos \"+\" e para posicionamento de um acima ao outro utilizamos \"/\".\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork)\n\n# Ao lado\np1 + p2\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Acima \np1 / p2\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n:::\n\n\nPara retirar a legenda dplicada devemos adicionar `plot_layout(guides = \"collect\")`. E para atribuir letras a cada gráfico utilizamos `plot_annotation(tag_levels = \"A\")`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Retirar a legenda duplicada\n(p1 + p2) +\n  plot_layout(guides = \"collect\")\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Atribuir letras a cada gráfico\n(p1 / p2) +\n  plot_layout(guides = \"collect\") +\n  plot_annotation(tag_levels = \"A\")\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-11-2.png){width=672}\n:::\n:::\n\n\nPara salvar o gráfico, utilizamos a função `ggsave()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"patch1.png\", width = 5, \n       height = 4)\n```\n:::\n\n\nPara retirar a duplicação de cultivar e severidade nos graficos adicionamos `axes = \"collect\"`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(p1 / p2) +\nplot_layout(guides = \"collect\",\n            axes = \"collect\" ) +\n  plot_annotation(tag_levels = \"A\")\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nPara atribuir um título geral e fonte aos gráficos, adicionamos `plot_annotation(title = \"Título\", caption = \"fonte\"`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(p1 / p2) +\nplot_layout(guides = \"collect\",\n            axes = \"collect\" ) +\n  plot_annotation(title = \"Coffee rust in Ethiopia\",\n                  caption = \"source: Del Ponte(2022)\"\n                  ,tag_levels = \"A\")\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n## Adicionar um gráfico em um determinado posicionamento de um outro gráfico\n\nPara adicionar um gráfico ou elemento a outro gráfico em um posicionamento próprio, utilizamos a função `inset_element()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np3 <- cr_oromia %>% \n  ggplot(aes(x=sev2))+\n  geom_histogram()\n\np1 + inset_element (p3, left = 0.6, bottom = 0.6, right = 1, top = 1)\n```\n\n::: {.cell-output-display}\n![](Aula3.qmb_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Aula3.qmb_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}