---
title: "Aula 6"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
message: false
warning: false
---

# Inferencial

## Dois grupos independentes

Primeiro precisamos importar o conjunto de dados utilizando o pacote gsheet.

```{r}
library(gsheet)

mg <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=983033137")
```

### Visualização

Utilizamos um gráfico boxplot para uma visualização inicial dos dados e observação de características do conjunto.

```{r}
library(tidyverse)

mg %>% 
  ggplot (aes(trat,comp))+
  geom_boxplot()
```

### Teste

O teste t é utilizado somente quando há 2 grupos no conjunto de dados. Além disso, é necessário que sejam atendidas as premissas de distribuição normal e a variânça dos grupos sejam homogêneas.

Para realizar o teste t, os dados precisam se apresentar em grupos separados (formato largo). Assim, é preciso utilizar a função `pivot_wider()` para o conjunto de dados mg. Para execução do teste t utilizamos a função `t.test()`.

```{r}
mg2 <- mg %>% 
  pivot_wider(names_from = trat,
              values_from = comp)

teste1 <- t.test(mg2$Mg2, mg2$control)


#Para Utilizar o teste t quando as variânças não são homogêneas, deve adicionar var.qual = false 

#t.test(mg2$Mg2, mg2$control),
#var.equal = FALSE
```

Interpretação: Pelo teste realizado, temos que a média de Mg2 é 10.52 e a média do controle é de 15.678. O valor do pvalor é menor que 0,05, então se rejeita Ho. O intervalo de confiança apresentado se refere a diferença entre as médias.

### Verificar premissas

A função `shapiro.test()` testa se a distribuição é normal. Se pvalor é maior que 0,05, então não rejeita Ho e assume que há normalidade.

```{r}
shapiro.test(mg2$control)

shapiro.test(mg2$Mg2)

```

A função `var.test()` é utilizada para verificar se as variânças são homogêneas. Quando pvalor é maior que 0,05, então não rejeita Ho e assume que as variânças são homogêneas.

```{r}
var.test(mg2$control, mg2$Mg2)

```

Uma outra forma de verificar normalidade é utilizando as funções gráficas `qqnorm()` e `qqline()`. Será um indicativo visual de normalidade, em que, se a maioria dos pontos estiverem sobre a linha há indicativo de normalidade.

```{r}
qqnorm(mg2$control)
qqline(mg2$control)

```

### Texto complementar

Para criar um texto a respeito dos resultados do teste, pode-se utilizar o pacote **report** com a função `report()`.

```{r}
library(report)
report (teste1)
```

## Dois grupos dependentes

Quando há dois grupos dependentes, deve ser realizado o teste t pareado.

### Importação dos dados

```{r}
escala <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1729131173")
```

### Visualização

```{r}
escala %>% 
  ggplot (aes(assessment, acuracia)) +
  geom_boxplot()
```

### Modificação para formato largo

```{r}
escala2 <- escala %>% 
  select(assessment, rater, acuracia) %>% 
  pivot_wider(names_from = assessment,
              values_from = acuracia)
```

### Verificação de premissas e teste t

No caso do teste t pareado, adicionamos paired = TRUE ao script do teste.

```{r}
# Verificar se há normalidade
shapiro.test(escala2$Unaided)
shapiro.test(escala2$Aided1)

#Verificar se as varianças são homogêneas
var.test(escala2$Unaided, escala2$Aided1)

# Realizado com os dados originais
t.test(escala2$Aided1, escala2$Unaided,
       paired = TRUE,
       var.equal = FALSE)

```

## Teste não paramétrico

No teste não paramétrico não é necessário o atendimento das premissas para execução do teste estatístico.

### Teste

Wilcox test é o equivalente não paramétrico do teste t. Utilizamos a função `wilcox.test()`.

```{r}
wilcox.test(escala2$Aided1,
            escala2$Unaided,
            paired = TRUE)
```

## Três ou mais grupos de dados

Quando há três ou mais grupos de dados, realizamos uma análise de variânça (ANOVA). A ANOVA irá verificar se pelo menos uma das médias difere das demais.

### Importação dos dados

```{r}
micelial <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=959387827")

```

### Visualização

```{r}
micelial %>%  
  ggplot (aes(especie, tcm)) +
  geom_jitter(width = 0.05)

```

### ANOVA

Os dados devem ser ajustados para o modelo de ANOVA por meio da função `lm()` e o teste em si é realizado por meio da função `anova()`. A função `summary` permite a visualização de um resumo estatistico do teste.

```{r}
m1 <- lm(tcm ~ especie, data = micelial)

anova(m1)

summary(m1)
# coloca -1 após a especie para ter as médias diretamente
```

### Verificação de premissas

Na análise de variânça utilizamos a função `shapiro.test()` para verificação da normalidade e a função `bartlett.test()` para verificação da homogeneidade da variânça.

```{r}
shapiro.test(m1$residuals)

bartlett.test(tcm ~ especie, data = micelial)
```

Nomenclaturas ANOVA: sum sq = somatório dos quadrados; df = graus de liberdade; mean sq = média dos quadrados -\> sum sq / df; F value = valor F -\> Mean sq fator / Mean sq residuo

### Grupos distintos

Para verificar os grupos que são distintos estatisticamente, primeiro calculamos as médias dos grupos por meio da função `emmeans()` do pacote **emmeans**. Depois utilizamos a função `cld()`do pacote **multcomp** para visualizar os grupamentos distintos.

```{r}
library(emmeans)
medias1 <- emmeans(m1, ~ especie)

library(multcomp)
library(multcompView)
cld (medias1)
```

### Outras formas de verificação das premissas

Podemos analisar de forma gráfica as premissas por meio da função `plot (simulateResiduals())` do pacote **DHARMa** ou pela função `check_model()` do pacote **see**.

Também podemos verificar as premissas diretamente pelas funções `check_normality()` e `check_heteroscedasticity()` do pacote **performance**.

```{r}
library (DHARMa)
plot(simulateResiduals(m1))

library(performance)
check_normality(m1)
check_heteroscedasticity(m1)

library(see)
check_model(m1)
```
