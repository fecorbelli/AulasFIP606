---
title: "Aula4"
format: html
editor: visual
message: false
warning: false
---

# Usando datapasta

O comando **datapasta** permite copiar vetores de outros locais e colar diretamente no programa. As opções de colagem se encontram no menu "Addins".

```{r}

dat <- data.frame(
  stringsAsFactors = FALSE,
              trat = c("Mg2","Mg2","Mg2","Mg2",
                       "Mg2","Mg2","Mg2","Mg2","Mg2","Mg2","control",
                       "control","control","control","control","control","control",
                       "control","control","control"),
               rep = c(1L,2L,3L,4L,5L,6L,7L,8L,
                       9L,10L,1L,2L,3L,4L,5L,6L,7L,8L,9L,10L),
              comp = c(9,125,10,8,132,11,108,95,
                       108,104,1372,1591,157,142,159,1654,18,144,
                       1641,16))

dat
```

Exemplo utilizando os dados da tabela "dados.diversos" e o comando "paste as tribble".

```{r}
dat2 <- tibble::tribble(
              ~trat, ~rep, ~comp,
              "Mg2",   1L,     9,
              "Mg2",   2L,   125,
              "Mg2",   3L,    10,
              "Mg2",   4L,     8,
              "Mg2",   5L,   132,
              "Mg2",   6L,    11,
              "Mg2",   7L,   108,
              "Mg2",   8L,    95,
              "Mg2",   9L,   108,
              "Mg2",  10L,   104,
          "control",   1L,  1372,
          "control",   2L,  1591,
          "control",   3L,   157,
          "control",   4L,   142,
          "control",   5L,   159,
          "control",   6L,  1654,
          "control",   7L,    18,
          "control",   8L,   144,
          "control",   9L,  1641,
          "control",  10L,    16
          )

dat2
```

Exemplo utilizando o comando "paste as tribble" a partir de dados disponíveis em uma página na internet.

```{r}
pop <- tibble::tribble(
  ~`Pos.	País	População	Área.(km²)	Densidade.(habitantes.por.km²)`,
                                "0\t Macau\t649 335\t28,6\t22 402",
                                "1\t Mônaco\t37 308\t2,02\t18 713",
                 "2\tSingapura Singapura\t5 638 700\t716,1\t7 874",
                          "3\t Hong Kong\t7 184 000\t1 104\t6 544",
                                  "4\t Vaticano\t825\t0,49\t1 891",
                                  "5\t Malta\t417 617\t316\t1 321",
                               "6\t Maldivas\t427 756\t300\t1 426",
           "7\tBangladesh Bangladesh\t163 220 762\t144 000\t1 113",
                           "8\t Bahrein\t1 442 659[1]\t665\t1 035",
                                 "9\t Barbados\t279 254\t431\t647",
                            "10\t Taiwan\t22 894 384\t35 980\t636",
                                                          "︀慴됨捈ݡ退",
                                                           "\001"
  )



```

# Remodelar dados para formato longo

Quando os dados se encontram em formato largo é interessante fazer a remodelação dos dados para posteriormente criar um gráfico. Para isso utilizamos a função `pivot_longer()`.

```{r}

library(tidyverse)
pepper <- 
  tribble(
   ~t,  ~`1`,  ~`2`,  ~`3`,
   0,  0.08, 0.001, 0.001,
   7,  0.13,  0.01, 0.001,
  14,  0.78,  0.09,  0.01,
  21,  0.92,  0.25,  0.05,
  28,  0.99,   0.8,  0.18,
  35, 0.995,  0.98,  0.34,
  42, 0.999,  0.99,  0.48,
  49, 0.999, 0.999,  0.74
  ) 
pepper %>% 
  pivot_longer(2:4,
               names_to = "epidemic",
               values_to = "inc")
```

## Visualização gráfica

```{r}

pepper %>% 
  pivot_longer(2:4,
               names_to = "epidemic",
               values_to = "inc") %>% 
ggplot(aes(t,inc, color = epidemic))+
  geom_point()
```

# Anotações em gráficos

Para adicionar textos aos gráficos em posições específicas podemos utilizar a função `annotate()` com os argumentos geom = "text", x= e y= para o posicionamento e o que deve ser adicionado em label =.

```{r}
pepper %>% 
  pivot_longer(2:4,
               names_to = "epidemic",
               values_to = "inc") %>% 
ggplot(aes(t,inc, color = epidemic))+
  geom_point()+
  geom_line()+
  annotate(geom = "text",
           x = 12,
           y = 0.75,
           label = "1")+
 annotate(geom = "text",
           x = 25,
           y = 0.75,
           label = "2")+
 annotate(geom = "text",
           x = 45,
           y = 0.75,
           label = "3")+
  theme(legend.position = "none")

#ultima linha para retirar a legenda do gráfico e evitar a redundância
```

# Tabela de Contingência

Para contabilizar o número de observaçõs de detrminado dado podemos utilizar a função `count()` ou `tabyl()` do pacote janitor.

```{r}
cr <- read_csv("https://raw.githubusercontent.com/emdelponte/paper-coffee-rust-Ethiopia/master/data/survey_clean.csv")

# formato longo
cr %>%  
  count(region, zone)

library(janitor)

# formato largo
cr %>% 
  tabyl(region, zone)

# formato longo
cr %>% 
  tabyl(zone, region)

```

# Visualização

Para criação de um gráfico de barras utilizamos a função `geom_col()`. Para visualização dos grupos lado a lado utilizamos position = "dodge2", já para visualização empilhada utilizamos position = "stack".

```{r}

library(ggthemes)
cr %>%  
  count(farm_management, cultivar) %>% 
  ggplot(aes(cultivar, n, fill = farm_management,
             label = n))+
  geom_col(position = "dodge2")+
  scale_fill_canva()+
  theme_bw()+
  theme(strip.text.x = element_blank(),
legend.position = "top") +
  geom_text(position = position_dodge(width = 1))+
  facet_wrap(~cultivar, scales = "free_x")


```

# Gráfico barra de erro

Para criar um gráfico de barra de erro utilizamos a função `geom_errobar()`. Devemos construir antes dessa função uma camada com os dados de média e desvio padrão do conjunto de dados.

```{r}
library(gsheet)

mg <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit?gid=983033137#gid=983033137")

mg %>% 
  group_by(trat) %>% 
  summarise (mean_comp = mean(comp),
             sd_comp = sd(comp)) %>% 
  ggplot(aes(trat,mean_comp))+
  #geom_col(fill = "steelblue", width = 0.5)+
  geom_point(size = 3)+
  ylim(0,20)+
geom_errorbar(aes(ymin = mean_comp - sd_comp,
                  ymax = mean_comp + sd_comp),
             width = 0.02)+
  #para adicionar * de estatisticamente diferente
  annotate(geom = "text",
           x = 1, y = 17.5,
           label = "*")

mg %>% 
  ggplot(aes(trat,comp))+
  geom_jitter(width = 0.1)


```
